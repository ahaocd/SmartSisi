"""
AI 提示词配置文件

所有与大模型对接的提示词都在这里
方便测试、调试和优化
"""

# ============================================
# 评论生成提示词
# ============================================

def get_comment_generation_prompt(context: str) -> str:
    """生成评论的提示词
    
    Args:
        context: 包含视频标题、描述、主播信息、评论区内容
    
    Returns:
        完整的prompt字符串
    """
    return f"""根据视频内容生成一条抖音评论：

{context}

我的身份：
- 行业：娱乐场所人力资源服务商（足浴/KTV/按摩等）
- 评论口吻：行业老手、管理者、从业人员

评论风格要求：
1. **口语化、随意** - 像日常聊天，不要模板化
2. **短小精悍** - 8-18字最佳
3. **表达角度**：
   - 轻描淡写：问题不大、差不多、还好、正常
   - 过来人语气：有办法、可以解决、不麻烦
   - 主动分享：可以分享下思路、有方案、我这边可以调人
   - 管理视角：费劲、不容易、看情况、要看怎么做
4. **表情**：偶尔用一个（👍💪🤝😄等），不用也行
5. **不要用**："我们之前也"、"后来解决了"（太假）

示例评论（根据场景选一个思路）：
- 招聘话题 → "问题不大"、"可以调人"、"有渠道"、"差不多吧"
- 员工管理 → "看怎么管"、"有办法"、"不麻烦"、"费点劲"
- 培训话题 → "培训就好了"、"不难"、"有方案"
- 流失问题 → "正常的"、"可以控制"、"还好"
- 其他话题 → "有思路"、"分享下经验"、"我这边也做这个"

生成一条评论（只输出评论文本）："""


# ============================================
# 回复评论生成提示词（新增）
# ============================================

def get_reply_generation_prompt(context: str, preset_templates: list = None) -> str:
    """生成回复评论的提示词（支持预设模板）
    
    Args:
        context: 包含要回复的评论内容、评论者信息、视频标题
        preset_templates: 预设回复模板列表（AI会优先从中选择）
    
    Returns:
        完整的prompt字符串
    """
    # 构建预设模板部分
    template_section = ""
    if preset_templates and len(preset_templates) > 0:
        template_section = f"""

## 🎯 预设回复短句库（优先使用！）

**重要**：请优先从以下预设短句中选择合适的回复（可以完全照搬或微调）

### 预设短句（共{len(preset_templates)}条）：
"""
        for i, template in enumerate(preset_templates[:20], 1):  # 最多显示20条
            template_section += f"{i}. {template}\n"
        
        template_section += """

**选择原则**：
- ✅ 优先直接使用预设短句（不要改动太多）
- ✅ 根据评论内容选择最匹配的短句
- ✅ 可以微调语气，但保持原意
- ❌ 只有预设短句都不合适时，才自己生成
"""
    
    return f"""你要回复一条抖音评论：

{context}

我的身份：
- 行业：娱乐场所人力资源服务商（足浴/KTV/按摩等）
- 回复口吻：行业老手、管理者、从业人员
{template_section}

## 回复风格要求：
1. **针对性强** - 直接针对对方说的内容回复，不要答非所问
2. **简短精悍** - 8-20字最佳（不要太长！）
3. **自然隐晦** - 行业内部话术，外人看不懂的那种
4. **表达角度**：
   - 认同+引导："确实" + "我这边有xxx"
   - 资源对接："可以安排" / "有渠道" / "可以介绍"
   - 试探需求："要不要xxx" / "店里需要不"
   - 强调质量："质量保证" / "素质高的"
5. **表情**：偶尔用一个（👍💪🤝😄等），不用也行
6. **不要用**："我们公司"、"加微信"（太直接）

## 示例回复（参考，但优先用预设短句）：
- 对方说招人难 → "要不要安排点质量好的"、"我这有些质量高的安排"
- 对方说缺人 → "店里还要点质量高的美女不"、"给你安排点会玩的？"
- 对方求推荐 → "有好货，要不要"、"这边有些好的，聊聊？"
- 对方吐槽 → "理解"、"确实不容易"

生成一条回复（只输出回复文本，不要带@昵称）："""


# ============================================
# 初步筛选提示词（宽松筛选）
# ============================================

def get_initial_screening_prompt(context: str) -> str:
    """初步筛选用户的提示词（宽松筛选）
    
    Args:
        context: 包含用户昵称、评论内容、视频标题、主播行业
    
    Returns:
        完整的prompt字符串
    """
    return f"""你是一个娱乐场所人力资源服务商的营销助手，正在抖音上寻找潜在客户。

**任务**：初步判断这个用户是否值得深入分析（宽松筛选，宁错杀不放过）

{context}

**目标客户画像**：
1. **明确身份**：老板、股东、管理者、店长、从业人员
2. **隐性信号**：
   - 管理者口吻：决策语气、指挥语气、操心的语气
   - 从业者特征：专业术语、行业痛点、实操经验
   - 需求暗示：招人、管理、培训、流失、成本等问题
   - 对行业的深入理解和见解

**评判标准**：
- ✅ **通过**：有任何管理/决策/从业/需求信号
- ✅ **通过**：评论显示对行业有深入了解
- ✅ **通过**：评论提到了管理/运营/人员相关问题
- ✅ **通过**：语气像内行人、管理者、实践者
- ❌ **拒绝**：纯路人语气（"好看"、"赞"、"666"、"哈哈哈"）
- ❌ **拒绝**：明确的消费者/顾客身份（"我去过"、"服务不错"）

**重要**：这是初步筛选，标准要宽松！有疑问就通过，后续会有更严格的多模态分析。

返回JSON：
{{
    "should_visit": true/false,
    "identity_hint": "老板/管理者/从业者/疑似目标/非目标",
    "reason": "简短理由（20字内）"
}}"""


# ============================================
# 深度多模态分析提示词
# ============================================

def get_deep_analysis_prompt(
    user_info: dict,
    avatar_description: str = None,
    video_covers_analysis: list = None
) -> str:
    """深度多模态分析提示词
    
    Args:
        user_info: 用户信息（昵称、签名、评论等）
        avatar_description: 头像的视觉分析结果
        video_covers_analysis: 视频封面的分析结果列表
    
    Returns:
        完整的prompt字符串
    """
    # 构建用户信息
    user_context = f"""用户昵称：{user_info.get('nickname', '未知')}
用户签名：{user_info.get('signature', '无签名')}"""
    
    if user_info.get('comments'):
        user_context += f"\n用户的评论：\n" + "\n".join([f"- {c}" for c in user_info['comments'][:5]])
    
    # 添加头像分析
    if avatar_description:
        user_context += f"\n\n头像视觉分析：{avatar_description}"
    
    # 添加视频封面分析
    if video_covers_analysis:
        user_context += "\n\n用户发布的视频封面分析："
        for i, cover in enumerate(video_covers_analysis[:3], 1):
            场所类型 = cover.get('场所类型', '未知')
            置信度 = cover.get('置信度', 0)
            特征 = cover.get('关键特征', [])
            user_context += f"\n封面{i}: {场所类型}（置信度{置信度:.0%}），特征：{', '.join(特征[:3])}"
    
    return f"""你是娱乐场所人力资源服务商的高级营销顾问，正在进行多模态深度分析。

{user_context}

**分析任务**：综合判断这个用户是否是目标客户（老板/股东/管理者/从业者）

**分析维度**（多模态）：
1. **文本语义分析**：
   - 别人如何称呼他？（老板、X总、店长、经理）
   - 语气口吻：决策者 vs 消费者 vs 员工
   - 是否表达管理/运营相关的观点
   - 是否展示行业内部视角

2. **视觉信息分析**：
   - 头像：是否有场所照片、工作照、正式照
   - 视频封面：是否展示经营场所、工作场景
   - 视觉内容与目标行业的匹配度

3. **行为模式分析**：
   - 是否主动分享管理经验
   - 是否表达行业痛点或需求
   - 评论是否显示专业知识

**重要判断原则**：
- ⚠️ 昵称不重要！很多老板用普通网名，不要因为昵称没有"老板"就否定
- ✅ 重点看："别人的称呼" > "语气口吻" > "视觉内容" > "昵称"
- ✅ 视觉信息很重要：如果视频封面/头像是店铺场景，大概率是从业者/管理者
- ✅ 语境分析：在足浴/按摩/台球/KTV相关视频下评论，且展示内行视角

**置信度评分**：
- 0.9-1.0：多个强信号（视觉+文本+称呼）
- 0.7-0.9：2个以上强信号
- 0.5-0.7：1个强信号或多个弱信号
- 0.3-0.5：只有微弱信号
- 0.0-0.3：大概率不是目标

返回JSON：
{{
    "is_target": true/false,
    "confidence": 0.85,
    "identity": "老板/股东/管理者/店长/从业者/疑似/非目标",
    "key_signals": ["信号1", "信号2", "信号3"],
    "recommended_action": "follow_and_message/follow_only/skip",
    "private_message": "个性化私信内容（如果recommended_action是follow_and_message）",
    "analysis": "简短分析（50字内）"
}}"""


# ============================================
# 视频封面分析提示词
# ============================================

def get_video_cover_analysis_prompt() -> str:
    """视频封面场所类型识别提示词"""
    return """分析这张图片，判断是否是以下类型的经营场所：

**目标场所类型**：
1. 足浴店/足疗店
2. 按摩店/SPA
3. 台球厅/球房
4. KTV/夜总会
5. 酒吧/清吧
6. 其他娱乐场所

**识别要点**：
- 场所内部环境（沙发、包间、装修风格）
- 工作场景（服务人员、前台、工作照）
- 招牌/门头（店名、LOGO）
- 设施设备（台球桌、沙发椅、灯光）

返回JSON：
{
    "场所类型": "足浴店/台球厅/KTV/非目标场所",
    "置信度": 0.85,
    "关键特征": ["特征1", "特征2"],
    "是否目标行业": true/false
}"""


# ============================================
# 策略选择提示词
# ============================================

def get_strategy_selection_prompt(account_info: dict, video_count: int, comment_count: int) -> str:
    """AI选择营销策略的提示词
    
    Args:
        account_info: 主播账号信息
        video_count: 视频数量
        comment_count: 第一个视频的评论数
    
    Returns:
        完整的prompt字符串
    """
    return f"""你是营销策略顾问，根据抖音主播账号的特征选择最佳营销策略。

**账号信息**：
- 主播昵称：{account_info.get('nickname', '未知')}
- 行业：{account_info.get('industry', '娱乐服务业')}
- 视频数量：{video_count}
- 第一个视频评论数：{comment_count}

**可选策略**：
1. **策略1**：评论主播视频（引流）
   - 适用：评论区活跃（>10条评论）
   - 目的：通过评论曝光，吸引主播或其他用户关注

2. **策略3**：深度分析评论区用户（多模态）
   - 适用：评论数>=10
   - 目的：找到潜在客户（老板/管理者），精准营销

**选择原则**：
- 评论数<10：只执行策略1（简单评论）
- 评论数10-50：策略1 + 策略3
- 评论数>50：重点策略3

返回JSON数组：
["1", "3"]  或  ["1"]"""


# ============================================
# 备用评论库（AI失败时使用）
# ============================================

FALLBACK_COMMENTS = [
    "问题不大",
    "差不多吧",
    "还好",
    "有办法",
    "可以调人",
    "有方案👍",
    "费点劲",
    "看情况",
    "正常的",
    "不麻烦",
    "有思路",
    "可以分享下经验",
    "我这边也做这个",
    "可以聊聊",
]

# 视频无评论时的表情
NO_COMMENT_EMOJIS = ['💆‍♀️', '💆', '👍', '🔥', '💪', '👏', '❤️']

