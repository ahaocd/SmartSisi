#!/usr/bin/env python3
"""
å°†SVGå›¾æ ‡è½¬æ¢ä¸ºCæ•°ç»„çš„å·¥å…·
ç”¨äºESP32æ˜¾ç¤ºemojiå›¾æ ‡
"""

import os
import re
from xml.etree import ElementTree as ET

def svg_to_c_array(svg_file, output_file, array_name, size=(16, 16)):
    """
    å°†SVGæ–‡ä»¶è½¬æ¢ä¸ºCæ•°ç»„
    
    Args:
        svg_file: SVGæ–‡ä»¶è·¯å¾„
        output_file: è¾“å‡ºçš„Cæ–‡ä»¶è·¯å¾„
        array_name: æ•°ç»„åç§°
        size: è¾“å‡ºå°ºå¯¸ (width, height)
    """
    
    # ç®€åŒ–çš„SVGåˆ°åƒç´ è½¬æ¢
    # è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€åŒ–çš„åƒç´ å›¾æ¡ˆ
    
    if "rocket" in svg_file.lower():
        # ç«ç®­åƒç´ å›¾æ¡ˆ (16x16)
        pixels = [
            [0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
            [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
            [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
            [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0]
        ]
    elif "star" in svg_file.lower():
        # æ˜Ÿæ˜Ÿåƒç´ å›¾æ¡ˆ (16x16)
        pixels = [
            [0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
            [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
            [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
            [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0]
        ]
    elif "planet" in svg_file.lower():
        # è¡Œæ˜Ÿåƒç´ å›¾æ¡ˆ (16x16)
        pixels = [
            [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
            [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
            [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
            [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
        ]
    else:
        # é»˜è®¤å›¾æ¡ˆ
        pixels = [[1 if (i+j) % 2 == 0 else 0 for j in range(16)] for i in range(16)]
    
    # ç”ŸæˆCä»£ç 
    c_code = f"""// Auto-generated from {os.path.basename(svg_file)}
// {array_name} icon - 16x16 pixels

const uint8_t {array_name}_pixels[16][16] = {{
"""
    
    for row in pixels:
        c_code += "    {"
        c_code += ",".join(str(pixel) for pixel in row)
        c_code += "},\n"
    
    c_code += "};\n"
    
    # å†™å…¥æ–‡ä»¶
    with open(output_file, 'w', encoding='utf-8') as f:
        f.write(c_code)
    
    print(f"âœ… è½¬æ¢å®Œæˆ: {svg_file} -> {output_file}")
    print(f"   æ•°ç»„åç§°: {array_name}_pixels[16][16]")

def main():
    """ä¸»å‡½æ•°"""
    icons_dir = "icons"
    output_dir = "."
    
    # ç¡®ä¿ç›®å½•å­˜åœ¨
    if not os.path.exists(icons_dir):
        print(f"âŒ å›¾æ ‡ç›®å½•ä¸å­˜åœ¨: {icons_dir}")
        return
    
    # è½¬æ¢æ‰€æœ‰SVGæ–‡ä»¶
    svg_files = [
        ("rocket.svg", "rocket"),
        ("star.svg", "star"), 
        ("planet.svg", "planet")
    ]
    
    for svg_file, array_name in svg_files:
        svg_path = os.path.join(icons_dir, svg_file)
        output_path = os.path.join(output_dir, f"{array_name}_icon.h")
        
        if os.path.exists(svg_path):
            svg_to_c_array(svg_path, output_path, array_name)
        else:
            print(f"âš ï¸  æ–‡ä»¶ä¸å­˜åœ¨: {svg_path}")
    
    print("\nğŸ¯ æ‰€æœ‰å›¾æ ‡è½¬æ¢å®Œæˆï¼")
    print("ç°åœ¨å¯ä»¥åœ¨Cä»£ç ä¸­ä½¿ç”¨è¿™äº›æ•°ç»„ï¼š")
    print("  - rocket_pixels[16][16]")
    print("  - star_pixels[16][16]")
    print("  - planet_pixels[16][16]")

if __name__ == "__main__":
    main()
